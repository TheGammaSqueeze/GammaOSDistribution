<?xml version="1.0" encoding="UTF-8"?>
<!--
    The wizard:uris recorded here have the inconvenience of being generated by hand, but they allow
    for the full spread of launch flags (we need FLAG_ACTIVITY_NEW_TASK [0x10000000]), where the
    <intent> tag processed by Intent.parseIntent() does not.

    adb shell am to-intent-uri -a com.android.setupwizard.WELCOME -f 0x10000000 \-\-ez firstRun true
-->
<WizardScript xmlns:wizard="http://schemas.android.com/apk/res/com.google.android.setupwizard"
    wizard:version="2">

    <!-- Ask user if they want to migrate using usb. If the transferring process has already begun
        we will auto advance to usb_migration_after_add_account or wifi_migration_after_add_account.
        Requires activation via Gservices flag [RECOMMENDED] -->
    <WizardAction id="usb_migration"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.USB_MIGRATION;B.skipped_flow_choice=true;end">
        <!-- "Skip" is returned when restore cannot happen, so skip over other restore options
             as well -->
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="setup_as_new_flow" />
        <result wizard:name="usb_migration_with_account"
            wizard:resultCode="101"
            wizard:action="usb_migration_after_add_account" />
        <result wizard:name="add_account_during_usb_transfer"
            wizard:resultCode="103"
            wizard:action="add_account_during_usb_transfer" />
        <result wizard:name="setup_as_new"
            wizard:resultCode="104"
            wizard:action="setup_as_new_flow" />
        <result wizard:name="d2d"
            wizard:resultCode="105"
            wizard:action="restore_with_account_flow" />
        <result wizard:name="ios_restore"
            wizard:resultCode="106"
            wizard:action="migrate_from_ios" />
        <result wizard:name="cloud_restore"
            wizard:resultCode="107"
            wizard:action="restore_with_account_flow" />
        <!-- Should not receive the result code of demo mode in deferred flow -->
        <result wizard:name="demo_mode_flow"
            wizard:resultCode="108"
            wizard:action="demo_mode_flow" />
        <!-- Should not receive the result code of post dpm in deferred flow -->
        <result wizard:name="dpm_user_complete"
            wizard:resultCode="109"
            wizard:action="post_dpm_user_flow" />
        <result wizard:name="add_account_for_wifi_transfer"
          wizard:resultCode="111"
          wizard:action="add_account_for_wifi_transfer" />
        <result wizard:name="transfer_number_only"
            wizard:resultCode="112"
            wizard:action="setup_as_new_flow" />
        <result wizard:name="add_account_for_ios_wifi_transfer"
            wizard:resultCode="114"
            wizard:action="add_account_for_ios_wifi_transfer" />
        <result wizard:action="setup_as_new_flow" />
    </WizardAction>

    <WizardAction id="demo_mode_flow" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.DEMO_MODE;end">
        <!-- For Android S and above admin-integrated flow -->
        <result wizard:name="admin_integrated_flow"
            wizard:resultCode="103"
            wizard:action="END_OF_SCRIPT" />
        <result wizard:action="exit" />
    </WizardAction>

    <WizardAction id="add_account_during_usb_transfer"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=false;end" />

    <!-- Add an account for USB D2D -->
    <WizardAction id="account_setup_usb"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="rollback_auth_early_update" />
        <!-- Alternate flow if managed provisioning already set the user up (for enterprise) [RECOMMENDED] -->
        <result wizard:name="dpm_user_complete"
            wizard:resultCode="111"
            wizard:action="post_dpm_user_flow" />
        <!-- Alternate flow when managed provisioning has already set the user up and DPC setup hasn't run yet (for enterprise) [RECOMMENDED] -->
        <result wizard:name="device_owner_set"
            wizard:resultCode="123"
            wizard:action="post_dpm_user_flow" />
        <result wizard:action="usb_migration_after_add_account" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="rollback_auth_early_update"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="add_account_during_usb_transfer" />
    </WizardAction>

    <!-- Relaunch into usb migration flow -->
    <WizardAction id="usb_migration_after_add_account"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.D2D_MIGRATION_AFTER_ACCOUNT;end">
        <result wizard:action="gms_account_checkin_for_d2d" />
    </WizardAction>

    <WizardAction id="add_account_for_wifi_transfer"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=true;B.isWifiD2d=true;end" />

    <!-- Add an account for WiFi D2D -->
    <WizardAction id="account_setup_wifi"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;B.isWifiD2d=true;end">
        <result wizard:name="ok"
            wizard:resultCode="-1"
            wizard:action="restore_with_account_flow" />
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="no_account_flow" />
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="rollback_auth_early_update_wifi" />
        <result
            wizard:name="oem_restore"
            wizard:resultCode="103"
            wizard:action="oem_restore_after_add_account" />
        <result
            wizard:name="wifi_d2d"
            wizard:resultCode="104"
            wizard:action="wifi_migration_after_add_account" />
        <!-- Alternate flow if managed provisioning already set the user up (for enterprise) [RECOMMENDED] -->
        <result wizard:name="dpm_user_complete"
            wizard:resultCode="111"
            wizard:action="post_dpm_user_flow" />
        <!-- Alternate flow when managed provisioning has already set the user up and DPC setup hasn't run yet (for enterprise) [RECOMMENDED] -->
        <result wizard:name="device_owner_set"
            wizard:resultCode="123"
            wizard:action="post_dpm_user_flow" />
        <result wizard:action="wifi_migration_after_add_account" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="rollback_auth_early_update_wifi"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="add_account_for_wifi_transfer" />
    </WizardAction>

    <!-- Launch/Relaunch into wifi migration flow -->
    <WizardAction id="wifi_migration_after_add_account"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.D2D_MIGRATION_AFTER_ACCOUNT;B.startWifiD2d=true;end">
        <result wizard:action="gms_account_checkin_for_d2d" />
    </WizardAction>

    <WizardAction id="add_account_for_ios_wifi_transfer"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;end" />

    <!-- Add an account for iOS WiFi D2D -->
    <WizardAction id="account_setup_ios_wifi"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="rollback_auth_early_update_ios_wifi" />
        <!-- Alternate flow if managed provisioning already set the user up (for enterprise) [RECOMMENDED] -->
        <result wizard:name="dpm_user_complete"
            wizard:resultCode="111"
            wizard:action="post_dpm_user_flow" />
        <!-- Alternate flow when managed provisioning has already set the user up and DPC setup hasn't run yet (for enterprise) [RECOMMENDED] -->
        <result wizard:name="device_owner_set"
            wizard:resultCode="123"
            wizard:action="post_dpm_user_flow" />
        <result wizard:action="ios_wifi_migration_after_add_account" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="rollback_auth_early_update_ios_wifi"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="add_account_for_ios_wifi_transfer" />
    </WizardAction>

    <!-- Launch/Relaunch into iOS wifi migration flow -->
    <WizardAction id="ios_wifi_migration_after_add_account"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.D2D_MIGRATION_AFTER_ACCOUNT;B.startIosWifiD2d=true;end">
        <result wizard:action="gms_account_checkin_for_d2d" />
    </WizardAction>


    <!-- Set up without restoring from old device [RECOMMENDED] -->
    <WizardAction id="setup_as_new_flow" wizard:flow="SetupAsNewFlow"
          wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_account_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>


    <!-- Set up without an account [REQUIRED] -->
    <WizardAction id="no_account_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_no_account_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>


    <!-- Checkin with Gservices using account before start USB/WiFi D2D transfer. [REQUIRED] -->
    <WizardAction id="gms_account_checkin_for_d2d"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GMS_ACCOUNT_CHECKIN;end" />


    <!-- Set up using USB/WiFi D2D transfer [RECOMMENDED] -->
    <WizardAction id="d2d_restore_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_post_account_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>


    <!-- Placeholder for OEM restore flow [CUSTOMIZABLE] -->
    <WizardAction id="oem_restore_after_add_account" />

    <!-- Restore user data and apps from servers or another Android [REQUIRED] -->
    <WizardAction id="restore_with_account_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_account_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>


    <!-- Show instructions for migrating from iOS [RECOMMENDED] -->
    <WizardAction id="migrate_from_ios"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.IOS_SETUP;end" />


    <!-- Restore user data and apps from an iOS device [RECOMMENDED] -->
    <WizardAction id="restore_with_ios_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_account_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>

    <!-- Flow to run after a user-led device policy managed setup. [RECOMMENDED] -->
    <WizardAction id="post_dpm_user_flow" wizard:ifLifecycle="default"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_post_dpm_user_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>

    <!-- Leave Setup Wizard (for demo mode) [REQUIRED] -->
    <WizardAction id="exit"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.EXIT;end" />

    <!-- Labeled end of script (for branching) [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="END_OF_SCRIPT" />
</WizardScript>
