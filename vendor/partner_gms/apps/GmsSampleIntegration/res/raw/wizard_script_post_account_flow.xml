<?xml version="1.0" encoding="UTF-8"?>
<!--
    The wizard:uris recorded here have the inconvenience of being generated by hand, but they allow
    for the full spread of launch flags (we need FLAG_ACTIVITY_NEW_TASK [0x10000000]), where the
    <intent> tag processed by Intent.parseIntent() does not.

    The wizard action added wizard:ifLifecycle="default" will only be launched during initial setup.
    It will be skipped during deferred setup. Conversely, if the action defined
    wizard:ifLifecycle="deferred", it will only be launched during deferred setup.

    adb shell am to-intent-uri -a com.android.setupwizard.WELCOME -f 0x10000000 \-\-ez firstRun true
-->
<WizardScript xmlns:wizard="http://schemas.android.com/apk/res/com.google.android.setupwizard"
    wizard:version="2">

    <!-- Get current resotre flow to finish restore [RECOMMENDED] -->
    <WizardAction id="get_current_restore_flow_to_start_restore"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GET_RESTORE_FLOW;end">
        <result wizard:name="start_device_restore"
            wizard:resultCode="105"
            wizard:action="start_restore" />
        <result wizard:name="start_cloud_restore"
            wizard:resultCode="107"
            wizard:action="start_restore" />
        <result wizard:action="esim_setup_fallback" />
    </WizardAction>


    <!-- Start to restore apps from the cloud [RECOMMENDED] -->
    <WizardAction id="start_restore"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_start_cloud_restore_flow">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="common_setup_flow" />
        <result wizard:name="no_content"
            wizard:resultCode="2"
            wizard:action="common_setup_flow" />
    </WizardAction>


    <!-- Start eSIM fallback setup flow when eSIM setup failed before [RECOMMENDED] -->
    <WizardAction id="esim_setup_fallback"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.ESIM_SETUP;i.setup_type=2;end" />


    <!-- Common flow to set date and time, show service opt-ins, as well as terms of service [REQUIRED] -->
    <WizardAction id="common_setup_flow" wizard:flow="WithConnectionFlow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_common_flow" />


    <!-- Check if user has added an account then go to personalization flow [REQUIRED] -->
    <WizardAction id="mfm_check"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_CHECK;end">
        <result wizard:name="no_accounts_added"
            wizard:resultCode="1"
            wizard:action="select_pai" />
    </WizardAction>


    <!-- Common set of customization steps [RECOMMENDED] -->
    <WizardAction id="personalization_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_common_personalization_flow">
        <result wizard:action="AFTER_PERSONALIZATION" />
    </WizardAction>


    <!-- Screen to select Play Auto Installs. If the user chooses to complete setup later, the whole personalization flow is skipped except for PAI selection here [RECOMMENDED] -->
    <WizardAction id="select_pai" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.SELECT_PAI;end" />


    <WizardAction id="AFTER_PERSONALIZATION" wizard:ifLifecycle="default" />


    <!-- Get current resotre flow to finish restore [RECOMMENDED] -->
    <WizardAction id="get_current_restore_flow_to_finish"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GET_RESTORE_FLOW;end">
        <result wizard:name="resotre_with_usb_flow"
            wizard:resultCode="103"
            wizard:action="usb_migration_final_hold" />
        <result wizard:name="finish_device_restore"
            wizard:resultCode="105"
            wizard:action="finish_restore" />
        <result wizard:name="finish_cloud_restore"
            wizard:resultCode="107"
            wizard:action="finish_restore" />
        <result wizard:action="final_hold" />
    </WizardAction>


    <!-- Finish cloud restore process [RECOMMENDED] -->
    <WizardAction id="finish_restore"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_finish_cloud_restore_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>


    <!-- Wait for high-priority apks to be completed [RECOMMENDED] -->
    <WizardAction id="usb_migration_final_hold"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.USB_MIGRATION_FINAL_HOLD;end">
        <result wizard:name="setup_work_profile"
            wizard:resultCode="110"
            wizard:action="load_work_account_intent" />
        <result wizard:action="final_hold" />
    </WizardAction>


    <!-- Add an account -->
    <WizardAction id="load_work_account_intent" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=false;B.is_work_profile_setup=true;end" />


    <WizardAction id="work_account_setup" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;B.allowMultipleAccounts=true;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="work_rollback_auth_early_update" />
        <result wizard:action="final_hold" />
    </WizardAction>


    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="work_rollback_auth_early_update"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="load_work_account_intent" />
    </WizardAction>


    <!-- Wait for high-priority apks to be completed [RECOMMENDED] -->
    <WizardAction id="final_hold"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.FINAL_HOLD;end" />


    <!-- Wait for launcher layout to load [RECOMMENDED] -->
    <WizardAction id="load_launcher_layout" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_LAUNCHER_LAYOUT;end" />


    <WizardAction id="END_OF_SCRIPT" />

</WizardScript>
