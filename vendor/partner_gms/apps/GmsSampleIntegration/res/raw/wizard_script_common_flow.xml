<?xml version="1.0" encoding="UTF-8"?>
<!--
    The wizard:uris recorded here have the inconvenience of being generated by hand, but they allow
    for the full spread of launch flags (we need FLAG_ACTIVITY_NEW_TASK [0x10000000]), where the
    <intent> tag processed by Intent.parseIntent() does not.

    The wizard action added wizard:ifLifecycle="default" will only be launched during initial setup.
    It will be skipped during deferred setup. Conversely, if the action defined
    wizard:ifLifecycle="deferred", it will only be launched during deferred setup.

    adb shell am to-intent-uri -a com.android.setupwizard.WELCOME -f 0x10000000 \-\-ez firstRun true
-->
<WizardScript xmlns:wizard="http://schemas.android.com/apk/res/com.google.android.setupwizard"
    wizard:version="2">

    <!-- Set date, time, and time zone from automated services (or manually, if needed) [RECOMMENDED, CUSTOMIZEABLE] -->
    <WizardAction id="date_time_check" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.DATE_TIME_CHECK;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="save_user_name" />
    </WizardAction>

    <WizardAction id="date_time" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.DATE_TIME;end" />


    <!-- Save the user name from the account to the OS profile [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="save_user_name" wizard:ifLifecycle="default"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.SAVE_USER_NAME;end" />

    <!-- Show service opt-ins, as well as terms of service [REQUIRED] -->
    <WizardAction id="google_services"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GOOGLE_SERVICES;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="rollback_auth_early_update" />
        <result wizard:action="search_selector" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="rollback_auth_early_update"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="google_services" />
    </WizardAction>

    <!-- Show search selector screen [REQUIRED] -->
    <WizardAction id="search_selector" wizard:ifFlow="WithConnectionFlow"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.SELECT_SEARCH_ENGINE;end">
    </WizardAction>

    <!-- Start eSIM setup flow with account [RECOMMENDED] -->
    <WizardAction id="esim_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.ESIM_SETUP;i.setup_type=4;end" />

    <!-- Set up biometric screen lock [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="biometric"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.BIOMETRIC;end">
            <result wizard:name="skip"
                wizard:resultCode="1"
                wizard:action="END_OF_SCRIPT" />
    </WizardAction>

    <!-- Set screen lock options [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="lock_screen"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOCK_SCREEN;end" />

    <!-- Labeled end of script (for branching) [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="END_OF_SCRIPT" />

</WizardScript>
