<?xml version="1.0" encoding="UTF-8"?>
<!--
    The wizard:uris recorded here have the inconvenience of being generated by hand, but they allow
    for the full spread of launch flags (we need FLAG_ACTIVITY_NEW_TASK [0x10000000]), where the
    <intent> tag processed by Intent.parseIntent() does not.

    adb shell am to-intent-uri -a com.android.setupwizard.WELCOME -f 0x10000000 \-\-ez firstRun true
-->
<WizardScript xmlns:wizard="http://schemas.android.com/apk/res/com.google.android.setupwizard"
    wizard:version="2">

    <WizardAction id="check_user_unlock_dpm_user_complete"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.CHECK_USER_UNLOCK;end">
    </WizardAction>

    <WizardAction id="gms_checkin"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GMS_CHECKIN;end" />

    <!-- Factory Reset Protection (FRP) -->
    <WizardAction id="check_frp"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.CHECK_FRP;end">
        <result wizard:name="load_account_intent_frp_to_resolve_frp"
            wizard:resultCode="101"
            wizard:action="load_account_intent_frp" />
        <result wizard:action="account_added_check" />
    </WizardAction>

    <!-- Resolve the FRP challenge -->
    <WizardAction id="load_account_intent_frp"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=false;B.resolveFrpOnly=true;end" />

    <WizardAction id="resolve_frp"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;B.finishWhenDone=true;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="rollback_auth_early_update" />
        <result wizard:action="account_added_check" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="rollback_auth_early_update"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="load_account_intent_frp" />
    </WizardAction>

    <!-- If no account has been added, show the Google Services screen. -->
    <WizardAction id="account_added_check"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_CHECK;end">
        <result wizard:name="no_accounts_added"
            wizard:resultCode="1"
            wizard:action="google_services" />
        <result wizard:name="account_added"
            wizard:action="oem_post_setup" />
    </WizardAction>

    <!-- Show Google services opt-ins and Terms of Service [REQUIRED] -->
    <WizardAction id="google_services"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GOOGLE_SERVICES;end" />

    <!-- OEM completion [CUSTOMIZABLE] -->
    <WizardAction id="oem_post_setup"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.OEM_POST_SETUP;end">
    </WizardAction>

    <!-- Enterprise provisioning finalization flow. Required only in init setup flow. [REQUIRED] -->
    <WizardAction id="enterprise_finalization_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_post_dpm_provision_finalization_flow">
    </WizardAction>

    <!-- Google kid account setup. Must be the last setup action. [REQUIRED] -->
    <WizardAction id="kid_post_setup"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.KID_POST_SETUP;end" />

    <!-- Leave Setup Wizard [REQUIRED] -->
    <WizardAction id="exit"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.EXIT;end" />
</WizardScript>
