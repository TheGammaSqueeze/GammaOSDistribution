<?xml version="1.0" encoding="UTF-8"?>
<!--
    The wizard:uris recorded here have the inconvenience of being generated by hand, but they allow
    for the full spread of launch flags (we need FLAG_ACTIVITY_NEW_TASK [0x10000000]), where the
    <intent> tag processed by Intent.parseIntent() does not.

    The wizard action added wizard:ifLifecycle="default" will only be launched during initial setup.
    It will be skipped during deferred setup. Conversely, if the action defined
    wizard:ifLifecycle="deferred", it will only be launched during deferred setup.

    adb shell am to-intent-uri -a com.android.setupwizard.WELCOME -f 0x10000000 \-\-ez firstRun true
-->
<WizardScript xmlns:wizard="http://schemas.android.com/apk/res/com.google.android.setupwizard"
    wizard:version="2">

    <!-- Start eSIM fallback setup flow when eSIM setup failed before [RECOMMENDED] -->
    <WizardAction id="esim_setup_fallback" wizard:ifFlow="SetupAsNewFlow"
        wizard:uri="intent:#Intent;action=com.android.setupwizard.ESIM_SETUP;i.setup_type=2;end" />

    <!-- Get current resotre flow [RECOMMENDED] -->
    <WizardAction id="get_current_restore_flow"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GET_RESTORE_FLOW;end">
        <result wizard:name="load_account_intent_for_device_flow"
            wizard:resultCode="105"
            wizard:action="load_account_intent_for_device_flow" />
        <result wizard:action="load_account_intent_for_account_flow" />
    </WizardAction>

    <!-- Add an account for restore with device flow [REQUIRED] -->
    <WizardAction id="load_account_intent_for_device_flow"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=true;end">
        <result wizard:action="account_setup" />
    </WizardAction>

    <!-- Add an account [REQUIRED] -->
    <WizardAction id="load_account_intent_for_account_flow"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=false;end" />

    <WizardAction id="account_setup"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="no_account_flow" />
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="rollback_auth_early_update" />
        <!-- Alternate flow if managed provisioning already set the user up (for enterprise) [RECOMMENDED] -->
        <result wizard:name="dpm_user_complete"
            wizard:resultCode="111"
            wizard:action="post_dpm_user_flow" />
        <result wizard:name="work_profile_setup"
            wizard:resultCode="122"
            wizard:action="work_profile_setup" />
        <result wizard:name="device_owner_setup"
            wizard:resultCode="123"
            wizard:action="post_dpm_user_flow" />
        <result wizard:action="gms_account_checkin" />
    </WizardAction>

    <!-- Script that includes steps to rollback auth early update [REQUIRED] -->
    <WizardAction id="rollback_auth_early_update"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="get_current_restore_flow" />
    </WizardAction>

    <WizardAction id="work_profile_setup"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_CHECK;end">
        <result wizard:name="personal_accounts_added"
            wizard:resultCode="-1"
            wizard:action="gms_account_checkin" />
        <result wizard:action="work_profile_setup_post_dpm_provision" />
    </WizardAction>

    <WizardAction id="work_profile_setup_post_dpm_provision"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_post_dpm_provision_finalization_flow">
        <result wizard:action="transition_to_personal_profile_setup" />
    </WizardAction>

    <WizardAction id="transition_to_personal_profile_setup"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.TRANSITION_TO_PERSONAL_PROFILE_SETUP;end">
        <result wizard:action="load_account_intent_for_personal_account_setup" />
    </WizardAction>

    <!-- Add personal account after work profile provisioning [REQUIRED] -->
    <WizardAction id="load_account_intent_for_personal_account_setup"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.LOAD_ADD_ACCOUNT_INTENT;B.showTapAndGo=false;end">
        <result wizard:action="add_personal_account" />
    </WizardAction>

    <!-- Add an account [REQUIRED] -->
    <WizardAction id="add_personal_account"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.ACCOUNT_SETUP;B.allowMultipleAccounts=true;end">
        <result wizard:name="unintentional_cancel"
            wizard:resultCode="102"
            wizard:action="personal_profile_rollback_auth_early_update" />
        <result wizard:action="gms_account_checkin" />
    </WizardAction>

    <WizardAction id="personal_profile_rollback_auth_early_update"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_rollback_auth_early_update_flow">
        <result wizard:action="transition_to_personal_profile_setup" />
    </WizardAction>

    <!-- Checkin with Gservices using account. [REQUIRED] -->
    <WizardAction id="gms_account_checkin"
        wizard:uri="intent:#Intent;action=com.google.android.setupwizard.GMS_ACCOUNT_CHECKIN;end">
        <result wizard:name="skip"
            wizard:resultCode="1"
            wizard:action="no_account_flow" />
    </WizardAction>


    <!-- Set up with an account [REQUIRED] -->
    <WizardAction id="account_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_post_account_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>


    <!-- Set up without an account [REQUIRED] -->
    <WizardAction id="no_account_flow"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_no_account_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>

    <!-- Flow to run after a user-led device policy managed setup. [RECOMMENDED] -->
    <WizardAction id="post_dpm_user_flow" wizard:ifLifecycle="default"
        wizard:script="android.resource://com.google.android.gmsintegration/raw/wizard_script_post_dpm_user_flow">
        <result wizard:action="END_OF_SCRIPT" />
    </WizardAction>

    <!-- Labeled end of script (for branching) [RECOMMENDED, CUSTOMIZABLE] -->
    <WizardAction id="END_OF_SCRIPT" />

</WizardScript>
