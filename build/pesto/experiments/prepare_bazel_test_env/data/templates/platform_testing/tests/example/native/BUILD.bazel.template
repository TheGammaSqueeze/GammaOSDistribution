# Copyright {year}, The Android Open Source Project
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# WARNING: This BUILD file was generated by a tool.
# It should not be manually modified.

# SOONG_TARGET:hello_world_test

package(default_visibility=["//visibility:public"])

load("//build/bazel/rules:cc_test.bzl", "cc_test")

_LIB_SRCS = glob([
    "{prebuilts_dir_name}/host/lib/**/*",
    "{prebuilts_dir_name}/host/lib64/**/*"
])
_TESTCASE_HOST_SRCS = glob(
    ["{prebuilts_dir_name}/host/testcases/hello_world_test/**/*"])
_TESTCASE_DEVICE_SRCS = glob(["{prebuilts_dir_name}/target_testcases/hello_world_test/**/*"])

_LIB_OUTS = [f.replace("{prebuilts_dir_name}/host/", "") for f in _LIB_SRCS]
_TESTCASE_HOST_OUTS = [
    f.replace("{prebuilts_dir_name}/host/testcases/hello_world_test/", "host/")
    for f in _TESTCASE_HOST_SRCS
]
_TESTCASE_DEVICE_OUTS = [
    f.replace("{prebuilts_dir_name}/target_testcases/hello_world_test/", "device/")
    for f in _TESTCASE_DEVICE_SRCS
]


genrule(name="hello_world_test_prebuilt",
        srcs=_LIB_SRCS + _TESTCASE_HOST_SRCS + _TESTCASE_DEVICE_SRCS,
        outs=_LIB_OUTS + _TESTCASE_HOST_OUTS + _TESTCASE_DEVICE_OUTS,
        cmd="""
          src_files=($(SRCS))
          out_files=($(OUTS))
          for i in "$${{!src_files[@]}}"
          do
            src_file=$${{src_files[$$i]}}
            out_file=$${{out_files[$$i]}}
            mkdir -p $$(dirname $$src_file)
            cp $$src_file $$out_file
          done
          """)

cc_test(name="hello_world_test", deps=[":hello_world_test_prebuilt"])
