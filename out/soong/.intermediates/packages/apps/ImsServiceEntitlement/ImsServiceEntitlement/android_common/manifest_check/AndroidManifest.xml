<?xml version="1.0" encoding="utf-8"?>
<!--
 Copyright (C) 2021 The Android Open Source Project

     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
-->
<manifest package="com.android.imsserviceentitlement" xmlns:android="http://schemas.android.com/apk/res/android">

    <uses-sdk android:minSdkVersion="32" android:targetSdkVersion="32"/>

    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
    <uses-permission android:name="android.permission.CHANGE_NETWORK_STATE"/>
    <uses-permission android:name="android.permission.INTERNET"/>
    <uses-permission android:name="android.permission.MODIFY_PHONE_STATE"/>
    <uses-permission android:name="android.permission.READ_PRIVILEGED_PHONE_STATE"/>
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/>
    <uses-permission android:name="android.permission.WAKE_LOCK"/>
    <uses-permission android:name="com.google.android.setupwizard.SETUP_COMPAT_SERVICE"/>

    <!-- after SDK 30, package need to declare its visible packages. -->
    <queries>
        <intent>
            <action android:name="com.android.setupwizard.action.PARTNER_CUSTOMIZATION"/>
        </intent>
    </queries> <!-- after SDK 30, package need to declare its visible packages. -->
    <queries>
        <intent>
            <action android:name="com.android.setupwizard.action.PARTNER_CUSTOMIZATION"/>
        </intent>
    </queries> <!-- Required by older versions of Google Play services to create IID tokens -->
    <uses-permission android:name="com.google.android.c2dm.permission.RECEIVE"/>

    <application android:appComponentFactory="androidx.core.app.CoreComponentFactory" android:extractNativeLibs="true">
        <activity android:exported="true" android:name="com.android.imsserviceentitlement.WfcActivationActivity" android:screenOrientation="nosensor" android:theme="@style/SudThemeGlif.Light">
        </activity>

        <service android:exported="true" android:name="com.android.imsserviceentitlement.ImsEntitlementPollingService" android:permission="android.permission.BIND_JOB_SERVICE">
        </service>

        <!-- START: FCM related components -->
        <!-- The FcmReceiver is in GMS client lib; need to declare it here to receive FCM. -->
        <receiver android:exported="true" android:name="com.android.imsserviceentitlement.fcm.FcmRegistrationReceiver">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED"/>
            </intent-filter>
        </receiver>

        <service android:exported="true" android:name="com.android.imsserviceentitlement.fcm.FcmService">
            <intent-filter>
                <action android:name="com.google.firebase.MESSAGING_EVENT"/>
            </intent-filter>
        </service>
        <service android:exported="true" android:name="com.android.imsserviceentitlement.fcm.FcmRegistrationService" android:permission="android.permission.BIND_JOB_SERVICE">
        </service>
        <!-- END: FCM related components -->

        <receiver android:exported="true" android:name="com.android.imsserviceentitlement.ImsEntitlementReceiver">
            <intent-filter>
                <action android:name="android.telephony.action.CARRIER_CONFIG_CHANGED"/>
            </intent-filter>
        </receiver>

        <provider android:authorities="com.android.imsserviceentitlement.firebaseinitprovider" android:directBootAware="true" android:exported="false" android:initOrder="100" android:name="com.google.firebase.provider.FirebaseInitProvider"/>

        <service android:directBootAware="true" android:exported="false" android:name="com.google.firebase.components.ComponentDiscoveryService">

            <!--
                This registrar is not defined in the dynamic-module-support sdk itself to allow non-firebase
                clients to use it as well, by defining this registrar in their own core/common library.
            -->
            <meta-data android:name="com.google.firebase.components:com.google.firebase.dynamicloading.DynamicLoadingRegistrar" android:value="com.google.firebase.components.ComponentRegistrar"/>
            <meta-data android:name="com.google.firebase.components:com.google.firebase.iid.Registrar" android:value="com.google.firebase.components.ComponentRegistrar"/>
            <meta-data android:name="com.google.firebase.components:com.google.firebase.installations.FirebaseInstallationsRegistrar" android:value="com.google.firebase.components.ComponentRegistrar"/>
            <meta-data android:name="com.google.firebase.components:com.google.firebase.messaging.FirebaseMessagingRegistrar" android:value="com.google.firebase.components.ComponentRegistrar"/>
            <meta-data android:name="com.google.firebase.components:com.google.firebase.datatransport.TransportRegistrar" android:value="com.google.firebase.components.ComponentRegistrar"/>
        </service>

        <receiver android:exported="true" android:name="com.google.firebase.iid.FirebaseInstanceIdReceiver" android:permission="com.google.android.c2dm.permission.SEND">
            <intent-filter>
                <action android:name="com.google.android.c2dm.intent.RECEIVE"/>
            </intent-filter>
        </receiver>
        <!--
             FirebaseMessagingService performs security checks at runtime,
             but set to not exported to explicitly avoid allowing another app to call it.
        -->
        <service android:directBootAware="true" android:exported="false" android:name="com.google.firebase.messaging.FirebaseMessagingService">
            <intent-filter android:priority="-500">
                <action android:name="com.google.firebase.MESSAGING_EVENT"/>
            </intent-filter>
        </service>

        <meta-data android:name="com.google.android.gms.version" android:value="@integer/google_play_services_version"/>

        <service android:exported="false" android:name="com.google.android.datatransport.runtime.scheduling.jobscheduling.JobInfoSchedulerService" android:permission="android.permission.BIND_JOB_SERVICE">
        </service>

        <receiver android:exported="false" android:name="com.google.android.datatransport.runtime.scheduling.jobscheduling.AlarmManagerSchedulerBroadcastReceiver"/>

        <service android:exported="false" android:name="com.google.android.datatransport.runtime.backends.TransportBackendDiscovery">
            <meta-data android:name="backend:com.google.android.datatransport.cct.CctBackendFactory" android:value="cct"/>
        </service>
    </application>

</manifest>
